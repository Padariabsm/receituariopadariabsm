<!DOCTYPE html>
<html>
<head>
  <title>Calculadora de Ingredientes</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<div class="container">
  <h2>Calculadora de Ingredientes</h2>
  <div class="mb-3">
    <label for="eanInput" class="form-label">EAN:</label>
    <input type="text" id="eanInput" class="form-control" oninput="exibirTextoBreveMaterial()" />
  </div>
  <div class="mb-3">
    <label for="textoBreveMaterial" class="form-label">Texto breve material:</label>
    <span id="textoBreveMaterial"></span>
  </div>
  <div class="mb-3">
    <label for="quantidadeInput" class="form-label">Quantidade:</label>
    <input type="text" id="quantidadeInput" class="form-control" />
  </div>
  <button onclick="buscarIngredientes()" class="btn btn-primary">Buscar</button>
  <div id="resultadoDiv" class="mt-3"></div>
</div>

<script>
  // Função para exibir o Texto breve material correspondente ao digitar o EAN
  function exibirTextoBreveMaterial() {
    var ean = $("#eanInput").val();
    var filteredData = dados.Sheet1.filter(function (item) {
      return item.EAN === ean;
    });
    if (filteredData.length > 0) {
      var textoBreveMaterial = filteredData[0].Produto;
      $("#textoBreveMaterial").text(textoBreveMaterial);
    } else {
      $("#textoBreveMaterial").text("");
    }
  }

  // Função para buscar os ingredientes e exibir a tabela
  function buscarIngredientes() {
    var ean = $("#eanInput").val();
    var quantidade = parseFloat($("#quantidadeInput").val());

    // Realizar a solicitação AJAX para carregar os dados do JSON
    $.getJSON('dados.json', function(data) {
      // Filtrar os dados do JSON pelo EAN informado
      var filteredData = data.Sheet1.filter(function (item) {
        return item.EAN === ean;
      });

      // Criar a tabela HTML
      var table = "<table class='table'><thead><tr><th>Ingrediente</th><th>Quantidade</th><th>Unidade de Medida</th></tr></thead><tbody>";

      // Calcular a quantidade de cada ingrediente multiplicando pela quantidade informada
      filteredData.forEach(function (item) {
        var quantidadeComponente = item.Quantidade * quantidade;
        table += "<tr><td>" + item.Ingrediente + "</td><td>" + quantidadeComponente.toFixed(3) + "</td><td>" + item["Unid.med.componente"] + "</td></tr>";
      });

      table += "</tbody></table>";

      // Exibir a tabela na div de resultado
      $("#resultadoDiv").html(table);
    });
  }
</script>

</body>
</html>
